<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Management Dashboard</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://unpkg.com/lucide@latest"></script>

    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>
    <link href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css" rel="stylesheet" type="text/css" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Tailwind gray-100 */
        }
        
        /* App View Management */
        .app-view {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        .app-view.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Sidebar Styles */
        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            color: #d1d5db; /* gray-300 */
            font-weight: 500;
            transition: all 0.2s ease-in-out;
        }
        .sidebar-link:hover {
            background-color: #374151; /* gray-700 */
            color: white;
        }
        .sidebar-link.active {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
            font-weight: 600;
        }

        /* Quill Editor Height */
        #quill-editor {
            min-height: 250px;
            background-color: white;
        }
        
        /* Tagify Customization */
        .tagify {
            --tag-bg: #e0e7ff; /* indigo-100 */
            --tag-text-color: #3730a3; /* indigo-800 */
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0.5rem;
        }
        .tagify:hover {
            border-color: #a5b4fc; /* indigo-300 */
        }
        .tagify.tagify--focus {
            border-color: #4f46e5; /* indigo-600 */
        }
        
        /* Modal Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }
        .modal.open {
            display: flex;
        }
        .modal-content {
            animation: zoomIn 0.2s ease-out;
        }
        @keyframes zoomIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="w-64 flex-shrink-0 bg-gray-800 text-white flex flex-col h-full">
        <div class="h-16 flex items-center justify-center px-4 font-bold text-xl border-b border-gray-700">
            Admin Dashboard
        </div>
        <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
            <a href="#" class="sidebar-link" onclick="event.preventDefault()">
                <i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i> Dashboard
            </a>
            
            <div class="px-4 pt-4 pb-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">Blog</div>
            <a href="#" class="sidebar-link active" data-view="list-posts">
                <i data-lucide="layout-list" class="w-5 h-5 mr-3"></i> All Posts
            </a>
            <a href="#" class="sidebar-link" data-view="add-post">
                <i data-lucide="plus-square" class="w-5 h-5 mr-3"></i> Add New Post
            </a>
            <a href="#" class="sidebar-link" data-view="comments">
                <i data-lucide="messages-square" class="w-5 h-5 mr-3"></i> Comments
            </a>
            <a href="#" class="sidebar-link" data-view="analytics">
                <i data-lucide="bar-chart-3" class="w-5 h-5 mr-3"></i> Analytics
            </a>
            
            <div class="px-4 pt-4 pb-2 text-xs font-semibold text-gray-400 uppercase tracking-wider">Management</div>
            <a href="#" class="sidebar-link" onclick="event.preventDefault()">
                <i data-lucide="users" class="w-5 h-5 mr-3"></i> Users
            </a>
            <a href="#" class="sidebar-link" onclick="event.preventDefault()">
                <i data-lucide="settings" class="w-5 h-5 mr-3"></i> Settings
            </a>
        </nav>
    </aside>

    <main class="flex-1 overflow-y-auto p-6 md:p-10">
        
        <div id="list-posts" class="app-view active">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold text-gray-800">All Posts</h1>
                <button id="add-new-post-btn-main" class="bg-indigo-600 text-white px-4 py-2 rounded-lg font-semibold flex items-center hover:bg-indigo-700 transition-colors">
                    <i data-lucide="plus" class="w-5 h-5 mr-2"></i> Add New Post
                </button>
            </div>
            
            <div class="bg-white p-4 rounded-lg shadow-sm mb-6">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <input type="text" id="search-posts" placeholder="Search posts..." class="md:col-span-2 w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    
                    <select id="filter-category" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="">All Categories</option>
                        <option value="Technology">Technology</option>
                        <option value="Guides">Guides</option>
                        <option value="News">News</option>
                    </select>
                    
                    <select id="filter-status" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="">All Statuses</option>
                        <option value="Published">Published</option>
                        <option value="Draft">Draft</option>
                        <option value="Scheduled">Scheduled</option>
                    </select>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 border-b border-gray-200">
                            <tr>
                                <th class="p-4 w-12 text-left"><input type="checkbox" id="select-all-posts"></th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Title</th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Author</th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Category</th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Status</th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Published</th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="posts-table-body" class="divide-y divide-gray-200">
                            <tr><td colspan="7" class="p-8 text-center text-gray-500">Loading posts...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="post-form" class="app-view">
            <h1 id="form-title" class="text-3xl font-bold text-gray-800 mb-6">Add New Post</h1>
            
            <form id="blog-post-form">
                <input type="hidden" id="post-id">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    
                    <div class="lg:col-span-2 space-y-6">
                        <div class="bg-white p-6 rounded-lg shadow-sm">
                            <label for="post-title" class="block text-lg font-semibold text-gray-700 mb-2">Title</label>
                            <input type="text" id="post-title" placeholder="Your Post Title" class="w-full text-2xl font-bold px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>

                        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                            <div class="p-6 border-b">
                                <label class="block text-lg font-semibold text-gray-700">Content</label>
                            </div>
                            <div id="quill-editor"></div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-lg shadow-sm">
                            <label class="block text-lg font-semibold text-gray-700 mb-2">Attachments</label>
                            <div id="attachment-dropzone" class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-indigo-500 bg-gray-50">
                                <i data-lucide="paperclip" class="w-10 h-10 mx-auto text-gray-400"></i>
                                <p class="mt-2 text-gray-500">Drop files (PDF, ZIP, etc.) here or click to upload</p>
                                <input type="file" class="hidden" id="post-attachments" multiple>
                            </div>
                            <div id="attachment-list" class="mt-4 space-y-2">
                                </div>
                        </div>

                        <details class="bg-white rounded-lg shadow-sm">
                            <summary class="p-6 cursor-pointer text-lg font-semibold text-gray-700 flex justify-between items-center">
                                SEO Metadata (Optional)
                                <i data-lucide="chevron-down" class="w-5 h-5 transform transition-transform"></i>
                            </summary>
                            <div class="p-6 border-t space-y-4">
                                <div>
                                    <label for="seo-title" class="block text-sm font-medium text-gray-700">Meta Title</label>
                                    <input type="text" id="seo-title" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                </div>
                                <div>
                                    <label for="seo-description" class="block text-sm font-medium text-gray-700">Meta Description</label>
                                    <textarea id="seo-description" rows="3" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                                </div>
                                <div>
                                    <label for="seo-keywords" class="block text-sm font-medium text-gray-700">Keywords (comma-separated)</label>
                                    <input type="text" id="seo-keywords" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                </div>
                            </div>
                        </details>
                    </div>

                    <div class="lg:col-span-1 space-y-6">
                        <div class="bg-white p-6 rounded-lg shadow-sm">
                            <h2 class="text-lg font-semibold text-gray-700 mb-4 border-b pb-3">Publish</h2>
                            <div class="space-y-4">
                                <div>
                                    <label for="post-status" class="block text-sm font-medium text-gray-700">Status</label>
                                    <select id="post-status" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                        <option value="Draft">Draft</option>
                                        <option value="Published">Published</option>
                                        <option value="Scheduled">Scheduled</option>
                                    </select>
                                </div>
                                <div id="schedule-date-wrapper" class="hidden">
                                    <label for="post-schedule-date" class="block text-sm font-medium text-gray-700">Schedule Date</label>
                                    <input type="text" id="post-schedule-date" placeholder="Select date and time" class="mt-1 w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                </div>
                            </div>
                            <div class="flex justify-between items-center mt-6 pt-4 border-t">
                                <button type="button" id="save-draft-btn" class="text-gray-600 font-medium hover:text-indigo-600">Save Draft</button>
                                <button type="submit" class="bg-indigo-600 text-white px-5 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition-colors">
                                    Publish
                                </button>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-lg shadow-sm">
                            <h2 class="text-lg font-semibold text-gray-700 mb-4">Category</h2>
                            <select id="post-category" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="Uncategorized">Uncategorized</option>
                                <option value="Technology">Technology</option>
                                <option value="Guides">Guides</option>
                                <option value="News">News</option>
                                <option value="Lifestyle">Lifestyle</option>
                            </select>
                        </div>
                        
                        <div class="bg-white p-6 rounded-lg shadow-sm">
                            <h2 class="text-lg font-semibold text-gray-700 mb-4">Tags</h2>
                            <input id="post-tags" placeholder="Add tags...">
                        </div>

                        <div class="bg-white p-6 rounded-lg shadow-sm">
                            <h2 class="text-lg font-semibold text-gray-700 mb-4">Feature Image</h2>
                            <div id="image-dropzone" class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-indigo-500 bg-gray-50">
                                <i data-lucide="image" class="w-10 h-10 mx-auto text-gray-400"></i>
                                <p class="mt-2 text-gray-500">Drop image here or click to upload</p>
                                <input type="file" class="hidden" id="post-image" accept="image/*">
                            </div>
                            <div id="image-preview-wrapper" class="mt-4 hidden">
                                <img id="image-preview" src="#" alt="Image Preview" class="w-full h-auto rounded-lg">
                                <button type="button" id="remove-image-btn" class="mt-2 text-sm text-red-600 hover:text-red-800">Remove Image</button>
                            </div>
                        </div>
                    </div>

                </div>
            </form>
        </div>

        <div id="comments" class="app-view">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Manage Comments</h1>
            
            <div class="bg-white p-4 rounded-lg shadow-sm mb-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <input type="text" id="search-comments" placeholder="Search comments or author..." class="md:col-span-2 w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    
                    <select id="filter-comment-status" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="">All Statuses</option>
                        <option value="Pending">Pending</option>
                        <option value="Approved">Approved</option>
                        <option value="Spam">Spam</option>
                    </select>
                </div>
            </div>

            <div id="comments-list" class="space-y-6">
                <div class="bg-white p-6 rounded-lg shadow-sm text-center text-gray-500">Loading comments...</div>
            </div>
        </div>

        <div id="analytics" class="app-view">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Blog Analytics</h1>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <div class="flex items-center justify-between">
                        <p class="text-sm font-medium text-gray-500">Total Posts</p>
                        <i data-lucide="file-text" class="w-5 h-5 text-indigo-500"></i>
                    </div>
                    <p id="stats-total-posts" class="text-3xl font-bold text-gray-800 mt-2">0</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <div class="flex items-center justify-between">
                        <p class="text-sm font-medium text-gray-500">Total Views</p>
                        <i data-lucide="eye" class="w-5 h-5 text-green-500"></i>
                    </div>
                    <p id="stats-total-views" class="text-3xl font-bold text-gray-800 mt-2">0</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <div class="flex items-center justify-between">
                        <p class="text-sm font-medium text-gray-500">Total Comments</p>
                        <i data-lucide="messages-square" class="w-5 h-5 text-blue-500"></i>
                    </div>
                    <p id="stats-total-comments" class="text-3xl font-bold text-gray-800 mt-2">0</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <div class="flex items-center justify-between">
                        <p class="text-sm font-medium text-gray-500">Published / Drafts</p>
                        <i data-lucide="pie-chart" class="w-5 h-5 text-yellow-500"></i>
                    </div>
                    <p id="stats-published-drafts" class="text-3xl font-bold text-gray-800 mt-2">0 / 0</p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Popular Posts</h2>
                    <ul id="popular-posts-list" class="divide-y divide-gray-200">
                        <li class="py-3 text-center text-gray-500">No data available</li>
                    </ul>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Views Over Time (Mock)</h2>
                    <div class="h-64 bg-gray-50 rounded-lg flex items-end justify-center p-4">
                        <div class="flex items-end h-full w-full max-w-sm mx-auto space-x-2">
                            <div class="w-1/6 bg-indigo-300 rounded-t-lg" style="height: 30%"></div>
                            <div class="w-1/6 bg-indigo-300 rounded-t-lg" style="height: 50%"></div>
                            <div class="w-1/6 bg-indigo-300 rounded-t-lg" style="height: 40%"></div>
                            <div class="w-1/6 bg-indigo-300 rounded-t-lg" style="height: 70%"></div>
                            <div class="w-1/6 bg-indigo-300 rounded-t-lg" style="height: 80%"></div>
                            <div class="w-1/6 bg-indigo-500 rounded-t-lg" style="height: 90%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="delete-modal" class="modal">
        <div class="modal-content bg-white p-8 rounded-lg shadow-2xl w-full max-w-md m-4">
            <div class="text-center">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="trash-2" class="w-8 h-8 text-red-600"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Delete Post</h2>
                <p class="text-gray-600 mb-6">Are you sure you want to delete this post? This action cannot be undone.</p>
                <div class="flex justify-center gap-4">
                    <button id="cancel-delete-btn" class="px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-medium">Cancel</button>
                    <button id="confirm-delete-btn" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-medium">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <div id="reply-modal" class="modal">
        <div class="modal-content bg-white p-8 rounded-lg shadow-2xl w-full max-w-lg m-4">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Reply to Comment</h2>
            <div class="mb-4 bg-gray-50 p-4 rounded-lg border">
                <p class="text-sm font-medium text-gray-800" id="reply-author"></p>
                <p class="text-sm text-gray-600 mt-1" id="reply-original-text"></p>
            </div>
            <form id="reply-form">
                <input type="hidden" id="reply-comment-id">
                <textarea id="reply-text" rows="4" placeholder="Write your reply..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" required></textarea>
                <div class="flex justify-end gap-4 mt-6">
                    <button id="cancel-reply-btn" type="button" class="px-6 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 font-medium">Cancel</button>
                    <button id="submit-reply-btn" type="submit" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-medium">Submit Reply</button>
                </div>
            </form>
        </div>
    </div>


    <script type="module">
        // =============================================
        // Mock Database
        // =============================================
        let db = {
            posts: [
                {
                    id: 1,
                    title: "Getting Started with Tailwind CSS",
                    author: "Admin",
                    category: "Technology",
                    tags: ["css", "frontend", "tailwind"],
                    status: "Published",
                    publishDate: "2025-10-20T10:00:00Z",
                    content: [
                        { insert: "Tailwind CSS is a utility-first CSS framework." },
                        { attributes: { header: 1 }, insert: "\nWhy use it?" },
                        { insert: "\nIt allows for rapid UI development without writing custom CSS.\n" },
                    ],
                    featureImage: "https://images.unsplash.com/photo-1611162617213-7d724e0f2241?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1974&q=80",
                    attachments: [],
                    views: 1520,
                    commentsCount: 2
                },
                {
                    id: 2,
                    title: "My Favorite JavaScript Frameworks",
                    author: "Jane Doe",
                    category: "Guides",
                    tags: ["javascript", "react", "vue"],
                    status: "Draft",
                    publishDate: null,
                    content: [{ insert: "React, Vue, and Svelte are all great options..." }],
                    featureImage: null,
                    attachments: [],
                    views: 0,
                    commentsCount: 0
                },
                {
                    id: 3,
                    title: "Upcoming Tech Conference",
                    author: "Admin",
                    category: "News",
                    tags: ["conference", "tech"],
                    status: "Scheduled",
                    publishDate: "2025-11-01T14:00:00Z",
                    content: [{ insert: "The conference will be held next month. Don't miss it!" }],
                    featureImage: null,
                    attachments: [],
                    views: 0,
                    commentsCount: 0
                }
            ],
            comments: [
                {
                    id: 101,
                    postId: 1,
                    author: "CodeNewbie",
                    email: "newbie@test.com",
                    date: "2025-10-21T11:30:00Z",
                    text: "Great article! This really helped me understand Tailwind.",
                    status: "Approved",
                    reply: null
                },
                {
                    id: 102,
                    postId: 1,
                    author: "CSS_Master",
                    email: "master@test.com",
                    date: "2025-10-22T09:15:00Z",
                    text: "I still prefer writing my own CSS from scratch. Utility classes feel bloated.",
                    status: "Pending",
                    reply: null
                },
                {
                    id: 103,
                    postId: 1,
                    author: "SPAM_BOT_9000",
                    email: "spam@bot.com",
                    date: "2025-10-22T10:00:00Z",
                    text: "Buy my amazing crypto course now!!! www.notascam.com",
                    status: "Spam",
                    reply: null
                }
            ]
        };

        // =============================================
        // State & DOM Elements
        // =============================================
        let currentView = 'list-posts';
        let editingPostId = null;
        let quill, tagify, schedulePicker;
        let postToDeleteId = null;
        let commentToReplyId = null;

        const views = document.querySelectorAll('.app-view');
        const sidebarLinks = document.querySelectorAll('.sidebar-link[data-view]');
        const postsTableBody = document.getElementById('posts-table-body');
        const postForm = document.getElementById('blog-post-form');
        const postFormTitle = document.getElementById('form-title');
        const postIdInput = document.getElementById('post-id');
        const postTitleInput = document.getElementById('post-title');
        const postStatusSelect = document.getElementById('post-status');
        const scheduleDateWrapper = document.getElementById('schedule-date-wrapper');
        const postCategorySelect = document.getElementById('post-category');
        const imageDropzone = document.getElementById('image-dropzone');
        const imageInput = document.getElementById('post-image');
        const imagePreviewWrapper = document.getElementById('image-preview-wrapper');
        const imagePreview = document.getElementById('image-preview');
        const removeImageBtn = document.getElementById('remove-image-btn');
        const attachmentDropzone = document.getElementById('attachment-dropzone');
        const attachmentInput = document.getElementById('post-attachments');
        const attachmentList = document.getElementById('attachment-list');
        const commentsListView = document.getElementById('comments-list');
        const deleteModal = document.getElementById('delete-modal');
        const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
        const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
        const replyModal = document.getElementById('reply-modal');
        const replyForm = document.getElementById('reply-form');
        const cancelReplyBtn = document.getElementById('cancel-reply-btn');

        // =============================================
        // Initialization
        // =============================================
        document.addEventListener('DOMContentLoaded', () => {
            initQuill();
            initTagify();
            initFlatpickr();
            setupEventListeners();
            
            // Initial render
            renderPostsList();
            lucide.createIcons();
        });

        function initQuill() {
            const toolbarOptions = [
                [{ 'header': [1, 2, 3, false] }],
                ['bold', 'italic', 'underline', 'strike'],
                [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                ['link', 'image', 'video', 'code-block'],
                ['clean']
            ];
            quill = new Quill('#quill-editor', {
                theme: 'snow',
                modules: {
                    toolbar: toolbarOptions
                }
            });
        }

        function initTagify() {
            const tagsInput = document.getElementById('post-tags');
            tagify = new Tagify(tagsInput, {
                whitelist: ["css", "frontend", "javascript", "react", "vue", "tech", "news"],
                dropdown: {
                    maxItems: 20,
                    enabled: 0,
                    closeOnSelect: false
                }
            });
        }

        function initFlatpickr() {
            schedulePicker = flatpickr("#post-schedule-date", {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
            });
        }

        // =============================================
        // Navigation / View Switching
        // =============================================
        function showView(viewId) {
            views.forEach(view => view.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');

            sidebarLinks.forEach(link => link.classList.remove('active'));
            document.querySelector(`.sidebar-link[data-view="${viewId}"]`)?.classList.add('active');
            
            // If it's a "pseudo-view" like 'add-post', show the form
            if (viewId === 'add-post') {
                showPostForm();
            } else {
                currentView = viewId;
                // Call render function for the specific view
                if (viewId === 'list-posts') renderPostsList();
                if (viewId === 'comments') renderCommentsList();
                if (viewId === 'analytics') renderAnalytics();
            }
        }
        
        // =============================================
        // Render Functions
        // =============================================
        function renderPostsList() {
            postsTableBody.innerHTML = ''; // Clear table
            
            const search = document.getElementById('search-posts').value.toLowerCase();
            const category = document.getElementById('filter-category').value;
            const status = document.getElementById('filter-status').value;

            let filteredPosts = db.posts.filter(post => {
                return (post.title.toLowerCase().includes(search) || post.author.toLowerCase().includes(search)) &&
                       (category === '' || post.category === category) &&
                       (status === '' || post.status === status);
            });
            
            if (filteredPosts.length === 0) {
                postsTableBody.innerHTML = `<tr><td colspan="7" class="p-8 text-center text-gray-500">No posts found.</td></tr>`;
                return;
            }

            filteredPosts.forEach(post => {
                const statusColors = {
                    Published: "bg-green-100 text-green-800",
                    Draft: "bg-yellow-100 text-yellow-800",
                    Scheduled: "bg-blue-100 text-blue-800"
                };
                
                const tr = document.createElement('tr');
                tr.className = "hover:bg-gray-50 transition-colors";
                tr.innerHTML = `
                    <td class="p-4"><input type="checkbox" class="post-checkbox" data-id="${post.id}"></td>
                    <td class="p-4">
                        <div class="font-medium text-gray-800">${post.title}</div>
                        <div class="text-sm text-gray-500">${(post.tags || []).join(', ')}</div>
                    </td>
                    <td class="p-4 text-sm text-gray-600">${post.author}</td>
                    <td class="p-4 text-sm text-gray-600">${post.category}</td>
                    <td class="p-4">
                        <span class="px-3 py-1 text-xs font-semibold rounded-full ${statusColors[post.status]}">
                            ${post.status}
                        </span>
                    </td>
                    <td class="p-4 text-sm text-gray-600">
                        ${post.publishDate ? new Date(post.publishDate).toLocaleDateString() : 'â€”'}
                    </td>
                    <td class="p-4">
                        <div class="flex space-x-2">
                            <button class="edit-btn p-1 text-indigo-600 hover:text-indigo-900" data-id="${post.id}" title="Edit">
                                <i data-lucide="edit-2" class="w-4 h-4"></i>
                            </button>
                            <button class="delete-btn p-1 text-red-600 hover:text-red-900" data-id="${post.id}" title="Delete">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                            <a href="#" class="p-1 text-blue-600 hover:text-blue-900" title="Preview" onclick="event.preventDefault()">
                                <i data-lucide="eye" class="w-4 h-4"></i>
                            </a>
                        </div>
                    </td>
                `;
                postsTableBody.appendChild(tr);
            });

            lucide.createIcons(); // Re-render icons
        }

        function renderCommentsList() {
            commentsListView.innerHTML = ''; // Clear list
            
            const search = document.getElementById('search-comments').value.toLowerCase();
            const status = document.getElementById('filter-comment-status').value;

            let filteredComments = db.comments.filter(comment => {
                return (comment.author.toLowerCase().includes(search) || comment.text.toLowerCase().includes(search)) &&
                       (status === '' || comment.status === status);
            });
            
            if (filteredComments.length === 0) {
                commentsListView.innerHTML = `<div class="bg-white p-6 rounded-lg shadow-sm text-center text-gray-500">No comments found.</div>`;
                return;
            }

            filteredComments.forEach(comment => {
                const post = db.posts.find(p => p.id === comment.postId);
                
                const statusColors = {
                    Approved: "border-green-500",
                    Pending: "border-yellow-500",
                    Spam: "border-red-500"
                };

                const div = document.createElement('div');
                div.className = `bg-white rounded-lg shadow-sm border-l-4 ${statusColors[comment.status]}`;
                div.innerHTML = `
                    <div class="p-6">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="font-semibold text-gray-800">${comment.author} <span class="text-sm text-gray-500 font-normal">(${comment.email})</span></div>
                                <div class="text-sm text-gray-500 mt-1">${new Date(comment.date).toLocaleString()}</div>
                            </div>
                            <div class="text-sm text-gray-500">
                                On: <a href="#" class="text-indigo-600 hover:underline" onclick="event.preventDefault()">${post ? post.title : 'Unknown Post'}</a>
                            </div>
                        </div>
                        <p class="text-gray-700 my-4">${comment.text}</p>
                        ${comment.reply ? `
                            <div class="bg-gray-50 p-3 rounded-lg border ml-8">
                                <p class="text-sm font-semibold text-gray-700">Reply from Admin:</p>
                                <p class="text-sm text-gray-600 mt-1">${comment.reply}</p>
                            </div>
                        ` : ''}
                    </div>
                    <div class="bg-gray-50 px-6 py-3 rounded-b-lg flex flex-wrap gap-2">
                        ${comment.status !== 'Approved' ? `
                            <button class="approve-comment-btn text-sm font-medium text-green-600 hover:text-green-800" data-id="${comment.id}">
                                <i data-lucide="check" class="w-4 h-4 inline-block mr-1"></i> Approve
                            </button>` : ''}
                        ${comment.status !== 'Pending' && comment.status !== 'Spam' && !comment.reply ? `
                            <button class="reply-comment-btn text-sm font-medium text-blue-600 hover:text-blue-800" data-id="${comment.id}">
                                <i data-lucide="corner-up-left" class="w-4 h-4 inline-block mr-1"></i> Reply
                            </button>` : ''}
                        ${comment.status !== 'Spam' ? `
                            <button class="spam-comment-btn text-sm font-medium text-yellow-600 hover:text-yellow-800" data-id="${comment.id}">
                                <i data-lucide="shield-alert" class="w-4 h-4 inline-block mr-1"></i> Spam
                            </button>` : ''}
                        <button class="delete-comment-btn text-sm font-medium text-red-600 hover:text-red-800 ml-auto" data-id="${comment.id}">
                            <i data-lucide="trash-2" class="w-4 h-4 inline-block mr-1"></i> Delete
                        </button>
                    </div>
                `;
                commentsListView.appendChild(div);
            });
            
            lucide.createIcons();
        }

        function renderAnalytics() {
            const totalPosts = db.posts.length;
            const totalViews = db.posts.reduce((acc, post) => acc + post.views, 0);
            const totalComments = db.comments.filter(c => c.status === 'Approved').length;
            const publishedCount = db.posts.filter(p => p.status === 'Published').length;
            const draftCount = db.posts.filter(p => p.status === 'Draft').length;

            document.getElementById('stats-total-posts').textContent = totalPosts;
            document.getElementById('stats-total-views').textContent = totalViews.toLocaleString();
            document.getElementById('stats-total-comments').textContent = totalComments;
            document.getElementById('stats-published-drafts').textContent = `${publishedCount} / ${draftCount}`;

            const popularList = document.getElementById('popular-posts-list');
            popularList.innerHTML = '';
            const popularPosts = [...db.posts].sort((a, b) => b.views - a.views).slice(0, 5);
            
            popularPosts.forEach(post => {
                const li = document.createElement('li');
                li.className = "py-4 flex justify-between items-center";
                li.innerHTML = `
                    <span class="font-medium text-gray-800">${post.title}</span>
                    <span class="text-sm text-gray-500">${post.views.toLocaleString()} views</span>
                `;
                popularList.appendChild(li);
            });
        }
        
        // =============================================
        // Form Handling
        // =============================================
        function showPostForm(postId = null) {
            postForm.reset(); // Clear form fields
            quill.setContents([]); // Clear Quill
            tagify.removeAllTags(); // Clear Tagify
            imagePreview.src = "#"; // Clear image
            imagePreviewWrapper.classList.add('hidden');
            attachmentList.innerHTML = '';
            
            if (postId) {
                // Edit Mode
                editingPostId = postId;
                const post = db.posts.find(p => p.id === postId);
                if (post) {
                    postFormTitle.textContent = "Edit Post";
                    postIdInput.value = post.id;
                    postTitleInput.value = post.title;
                    quill.setContents(post.content);
                    postStatusSelect.value = post.status;
                    postCategorySelect.value = post.category;
                    if (post.tags) {
                        tagify.loadOriginalValues(post.tags);
                    }
                    if (post.publishDate && post.status === 'Scheduled') {
                        schedulePicker.setDate(post.publishDate, true);
                        scheduleDateWrapper.classList.remove('hidden');
                    }
                    if (post.featureImage) {
                        imagePreview.src = post.featureImage;
                        imagePreviewWrapper.classList.remove('hidden');
                    }
                    // Mock attachments
                    (post.attachments || []).forEach(file => addAttachmentToList(file.name, file.url));
                }
            } else {
                // Add Mode
                editingPostId = null;
                postFormTitle.textContent = "Add New Post";
            }
            showView('post-form');
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            const id = editingPostId ? parseInt(editingPostId) : Date.now();
            const title = postTitleInput.value;
            const content = quill.getContents(); // Get Delta object from Quill
            const status = postStatusSelect.value;
            const category = postCategorySelect.value;
            const tags = tagify.value.map(tag => tag.value); // Get array of tag strings
            const featureImage = imagePreview.src.startsWith('http') ? imagePreview.src : null;
            const publishDate = status === 'Scheduled' ? schedulePicker.selectedDates[0] : (status === 'Published' ? new Date() : null);

            // Mock getting attachment data
            const attachments = Array.from(attachmentList.children).map(item => ({
                name: item.querySelector('span').textContent,
                url: item.querySelector('a').href
            }));

            if (!title) {
                alert("Please enter a title.");
                return;
            }

            const postData = {
                id,
                title,
                author: "Admin", // Mock author
                category,
                tags,
                status,
                publishDate: publishDate ? publishDate.toISOString() : null,
                content,
                featureImage,
                attachments,
                views: editingPostId ? db.posts.find(p => p.id === id).views : 0,
                commentsCount: editingPostId ? db.posts.find(p => p.id === id).commentsCount : 0
            };
            
            if (editingPostId) {
                // Update existing post
                const index = db.posts.findIndex(p => p.id === id);
                db.posts[index] = postData;
            } else {
                // Add new post
                db.posts.push(postData);
            }

            console.log("Saving Post:", postData);
            alert("Post saved successfully! (Check console for data)");
            
            editingPostId = null;
            showView('list-posts');
        }

        // =============================================
        // File / Image Handling (Mock)
        // =============================================
        function handleImageUpload(file) {
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    imagePreview.src = e.target.result;
                    imagePreviewWrapper.classList.remove('hidden');
                };
                reader.readAsDataURL(file); // This simulates the upload
            }
        }
        
        function addAttachmentToList(fileName, fileUrl = "#") {
            const div = document.createElement('div');
            div.className = "flex items-center justify-between bg-gray-100 p-2 rounded-lg";
            div.innerHTML = `
                <div class="flex items-center">
                    <i data-lucide="file-text" class="w-4 h-4 text-gray-500 mr-2"></i>
                    <span class="text-sm font-medium text-gray-700">${fileName}</span>
                </div>
                <div>
                    <a href="${fileUrl}" target="_blank" class="text-sm text-indigo-600 hover:underline mr-2">View</a>
                    <button type="button" class="remove-attachment-btn text-sm text-red-600 hover:text-red-800">&times;</button>
                </div>
            `;
            attachmentList.appendChild(div);
            lucide.createIcons();
            
            div.querySelector('.remove-attachment-btn').addEventListener('click', () => {
                div.remove();
            });
        }
        
        function handleAttachmentUpload(files) {
            for (const file of files) {
                // In a real app, you'd upload this and get a URL.
                // Here, we just add it to the list with a mock URL.
                addAttachmentToList(file.name, URL.createObjectURL(file));
            }
        }
        
        // =============================================
        // Delete / Comment Logic
        // =============================================
        function showDeleteModal(postId) {
            postToDeleteId = postId;
            deleteModal.classList.add('open');
        }
        
        function confirmDelete() {
            if (postToDeleteId) {
                db.posts = db.posts.filter(p => p.id !== postToDeleteId);
                console.log(`Deleted post with id: ${postToDeleteId}`);
                postToDeleteId = null;
                deleteModal.classList.remove('open');
                renderPostsList();
            }
        }
        
        function updateCommentStatus(commentId, newStatus) {
            const comment = db.comments.find(c => c.id === commentId);
            if (comment) {
                comment.status = newStatus;
                renderCommentsList();
            }
        }
        
        function deleteComment(commentId) {
            if (confirm("Are you sure you want to delete this comment?")) {
                db.comments = db.comments.filter(c => c.id !== commentId);
                renderCommentsList();
            }
        }

        function showReplyModal(commentId) {
            const comment = db.comments.find(c => c.id === commentId);
            if (comment) {
                commentToReplyId = commentId;
                document.getElementById('reply-author').textContent = `Replying to: ${comment.author}`;
                document.getElementById('reply-original-text').textContent = `"${comment.text}"`;
                replyForm.reset();
                replyModal.classList.add('open');
            }
        }
        
        function handleReplySubmit(e) {
            e.preventDefault();
            const replyText = document.getElementById('reply-text').value;
            const comment = db.comments.find(c => c.id === commentToReplyId);
            if (comment && replyText) {
                comment.reply = replyText;
                console.log(`Replied to comment ${commentToReplyId}: ${replyText}`);
                replyModal.classList.remove('open');
                commentToReplyId = null;
                renderCommentsList();
            }
        }

        // =============================================
        // Event Listeners
        // =============================================
        function setupEventListeners() {
            // Sidebar Navigation
            sidebarLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    showView(link.dataset.view);
                });
            });

            // "Add New" Buttons
            document.getElementById('add-new-post-btn-main').addEventListener('click', () => showPostForm());

            // List View Filters
            document.getElementById('search-posts').addEventListener('input', renderPostsList);
            document.getElementById('filter-category').addEventListener('change', renderPostsList);
            document.getElementById('filter-status').addEventListener('change', renderPostsList);

            // List View Table Actions (Event Delegation)
            postsTableBody.addEventListener('click', e => {
                const editBtn = e.target.closest('.edit-btn');
                const deleteBtn = e.target.closest('.delete-btn');
                if (editBtn) {
                    const id = parseInt(editBtn.dataset.id);
                    showPostForm(id);
                }
                if (deleteBtn) {
                    const id = parseInt(deleteBtn.dataset.id);
                    showDeleteModal(id);
                }
            });
            
            // Delete Modal
            confirmDeleteBtn.addEventListener('click', confirmDelete);
            cancelDeleteBtn.addEventListener('click', () => deleteModal.classList.remove('open'));
            
            // Post Form
            postForm.addEventListener('submit', handleFormSubmit);
            document.getElementById('save-draft-btn').addEventListener('click', () => {
                postStatusSelect.value = "Draft";
                handleFormSubmit(new Event('submit'));
            });
            postStatusSelect.addEventListener('change', e => {
                scheduleDateWrapper.classList.toggle('hidden', e.target.value !== 'Scheduled');
            });
            
            // Image Upload
            imageDropzone.addEventListener('click', () => imageInput.click());
            imageInput.addEventListener('change', e => handleImageUpload(e.target.files[0]));
            removeImageBtn.addEventListener('click', () => {
                imageInput.value = '';
                imagePreview.src = '#';
                imagePreviewWrapper.classList.add('hidden');
            });
            
            // Attachment Upload
            attachmentDropzone.addEventListener('click', () => attachmentInput.click());
            attachmentInput.addEventListener('change', e => handleAttachmentUpload(e.target.files));

            // Comments View Filters
            document.getElementById('search-comments').addEventListener('input', renderCommentsList);
            document.getElementById('filter-comment-status').addEventListener('change', renderCommentsList);
            
            // Comments List Actions (Event Delegation)
            commentsListView.addEventListener('click', e => {
                const target = e.target.closest('button');
                if (!target) return;
                const id = parseInt(target.dataset.id);
                if (target.classList.contains('approve-comment-btn')) updateCommentStatus(id, 'Approved');
                if (target.classList.contains('spam-comment-btn')) updateCommentStatus(id, 'Spam');
                if (target.classList.contains('delete-comment-btn')) deleteComment(id);
                if (target.classList.contains('reply-comment-btn')) showReplyModal(id);
            });
            
            // Reply Modal
            replyForm.addEventListener('submit', handleReplySubmit);
            cancelReplyBtn.addEventListener('click', () => replyModal.classList.remove('open'));
        }

    </script>
</body>
</html>
